<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
   <changeSet id="localizedvalues" author="antti.leppa">
    <createTable tableName="localizedentry">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
    </createTable>
    
    <createTable tableName="localizedvalue">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="entry_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_LOCALIZED_VALUE_ENTRY_ID" referencedColumnNames="id" referencedTableName="localizedentry"/>
      </column>
      <column name="locale" type="varchar(191)">
        <constraints nullable="false"/>
      </column>
      <column name="value" type="longtext">
        <constraints nullable="false"/>
      </column>    
    </createTable>
  </changeSet>
  
  <changeSet id="seed" author="antti.leppa">
    <createTable tableName="seed">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="name_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_SEED_LOCALIZED_ENTRY_ID" referencedColumnNames="id" referencedTableName="localizedentry"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  
  <changeSet id="team-19.12.2018-19:00" author="ville.koivukangas">
    <createTable tableName="team">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="name_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_TEAM_LOCALIZED_ENTRY_ID" referencedColumnNames="id" referencedTableName="localizedentry"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  
  <changeSet id="wastagereason" author="ville.koivukangas">
    <createTable tableName="wastagereason">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="reason_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_WASTAGEREASON_LOCALIZED_ENTRY_ID" referencedColumnNames="id" referencedTableName="localizedentry"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  
  <changeSet id="seedbatch" author="ville.koivukangas">
    <createTable tableName="seedbatch">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="code" type="varchar(191)">
        <constraints nullable="false"/>
      </column>
      <column name="seed_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_SEEDBATCH_SEED_ID" referencedColumnNames="id" referencedTableName="seed"/>
      </column>
      <column name="time" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  
  <changeSet id="packagesize" author="ville.koivukangas">
    <createTable tableName="packagesize">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="name" type="varchar(191)">
        <constraints nullable="false"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  
  <changeSet id="product" author="ville.koivukangas">
    <createTable tableName="product">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="name_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_PRODUCT_LOCALIZED_ENTRY_ID" referencedColumnNames="id" referencedTableName="localizedentry"/>
      </column>
      <column name="defaultpackagesize_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_PRODUCT_PACKAGESIZE_ID" referencedColumnNames="id" referencedTableName="packagesize"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  
  <changeSet id="batch" author="ville.koivukangas">
    <createTable tableName="batch">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="product_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_BATCH_PRODUCT_ID" referencedColumnNames="id" referencedTableName="product"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  
  <changeSet id="productionline" author="ville.koivukangas">
    <createTable tableName="productionline">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="linenumber" type="INT">
        <constraints nullable="false"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  
  <changeSet id="performedcultivationaction" author="ville.koivukangas">
    <createTable tableName="performedcultivationaction">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="name_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_PERFORMEDCULTIVATIONACTION_LOCALIZED_ENTRY_ID" referencedColumnNames="id" referencedTableName="localizedentry"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
      
  <changeSet id="event" author="antti.leppa">
    <createTable tableName="event">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="batch_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_EVENT_BATCH_ID" referencedColumnNames="id" referencedTableName="batch"/>
      </column>
      <column name="starttime" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="endtime" type="timestamp"/>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
      
  <changeSet id="sowingevent" author="antti.leppa">
    <createTable tableName="sowingevent">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true" foreignKeyName="FK_SOWINGEVENT_EVENT_ID" referencedColumnNames="id" referencedTableName="event"/>
      </column>
      <column name="seedbatch_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_SOWINGEVENT_SEEDBATCH_ID" referencedColumnNames="id" referencedTableName="seedbatch"/>
      </column>
      <column name="productionline_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_SOWINGEVENT_PRODUCTIONLINE_ID" referencedColumnNames="id" referencedTableName="productionline"/>
      </column>
      <column name="gutternumber" type="integer"/>
      <column name="celltype" type="varchar(191)">
        <constraints nullable="false"/>
      </column>
      <column name="amount" type="double">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  
  <changeSet id="tablespreadevent" author="antti.leppa">
    <createTable tableName="tablespreadevent">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true" foreignKeyName="FK_TABLESPREADEVENT_EVENT_ID" referencedColumnNames="id" referencedTableName="event"/>
      </column>
      <column name="location" type="varchar(191)">
        <constraints nullable="false"/>
      </column>
      <column name="tablecount" type="int(32)">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  
  <changeSet id="cultivationobservationevent" author="antti.leppa">
    <createTable tableName="cultivationobservationevent">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true" foreignKeyName="FK_CULTIVATIONOBSERVATIONEVENT_EVENT_ID" referencedColumnNames="id" referencedTableName="event"/>
      </column>
      <column name="pests" type="varchar(191)"/>
      <column name="weight" type="double"/>
      <column name="luminance" type="double"/>
    </createTable>
  </changeSet>
  
  <changeSet id="cultivationobservationeventaction" author="antti.leppa">
    <createTable tableName="cultivationobservationeventaction">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>      
      <column name="event_id" type="binary(16)">
        <constraints nullable="false" primaryKey="true" foreignKeyName="FK_CULTIVATIONOBSERVATIONEVENTACTION_EVENT_ID" referencedColumnNames="id" referencedTableName="event"/>
      </column>
      <column name="action_id" type="binary(16)">
        <constraints nullable="false" primaryKey="true" foreignKeyName="FK_CULTIVATIONOBSERVATIONEVENTACTION_ACTION_ID" referencedColumnNames="id" referencedTableName="performedcultivationaction"/>
      </column>
    </createTable>
  </changeSet>
      
  <changeSet id="harvestevent" author="antti.leppa">
    <createTable tableName="harvestevent">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true" foreignKeyName="FK_HARVESTEVENT_EVENT_ID" referencedColumnNames="id" referencedTableName="event"/>
      </column>
      <column name="team_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_HARVESTEVENT_TEAM_ID" referencedColumnNames="id" referencedTableName="team"/>
      </column>
      <column name="productionline_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_HARVESTEVENT_PRODUCTIONLINE_ID" referencedColumnNames="id" referencedTableName="productionline"/>
      </column>
      <column name="harvestType" type="varchar(191)">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
      
  <changeSet id="plantingevent" author="antti.leppa">
    <createTable tableName="plantingevent">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true" foreignKeyName="FK_PLANTINGEVENT_EVENT_ID" referencedColumnNames="id" referencedTableName="event"/>
      </column>
      <column name="productionline_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_PLANTINGEVENT_PRODUCTIONLINE_ID" referencedColumnNames="id" referencedTableName="productionline"/>
      </column>
      <column name="gutternumber" type="int(32)">
        <constraints nullable="false"/>
      </column>
      <column name="guttercount" type="int(32)">
        <constraints nullable="false"/>
      </column>
      <column name="traycount" type="int(32)">
        <constraints nullable="false"/>
      </column>
      <column name="workerCount" type="int(32)">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet id="wastageevent" author="Heikki Kurhinen">
    <createTable tableName="wastageevent">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true" foreignKeyName="FK_WASTAGEEVENT_EVENT_ID" referencedColumnNames="id" referencedTableName="event"/>
      </column>
      <column name="wastagereason_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_WASTAGEEVENT_WASTAGEREASON_ID" referencedColumnNames="id" referencedTableName="wastagereason"/>
      </column>
      <column name="amount" type="int(32)">
        <constraints nullable="false"/>
      </column>
      <column name="description" type="longtext"></column>
    </createTable>
  </changeSet>

      
  <changeSet id="packingevent" author="antti.leppa">
    <createTable tableName="packingevent">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true" foreignKeyName="FK_PACKINGEVENT_EVENT_ID" referencedColumnNames="id" referencedTableName="event"/>
      </column>
      <column name="packagesize_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_PACKINGEVENT_PACKAGESIZE_ID" referencedColumnNames="id" referencedTableName="packagesize"/>
      </column>
      <column name="packedamount" type="int(32)">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>  

      
  <changeSet id="batchstatus" author="antti.leppa">
    <delete tableName="packingevent"/>
    <delete tableName="wastageevent"/>
    <delete tableName="plantingevent"/>
    <delete tableName="packingevent"/>
    <delete tableName="harvestevent"/>
    <delete tableName="cultivationobservationeventaction"/>
    <delete tableName="cultivationobservationevent"/>
    <delete tableName="tablespreadevent"/>
    <delete tableName="sowingevent"/>
    <delete tableName="event"/>
    <delete tableName="batch"/>
  
    <addColumn tableName="event">
      <column name="remainingunits" type="int(32)">
        <constraints nullable="false"/>
      </column>
    </addColumn>
    
    <addColumn tableName="batch">
      <column name="activeevent_id" type="binary(16)">
        <constraints nullable="true" foreignKeyName="FK_BATCH_ACTIVE_EVENT_ID" referencedColumnNames="id" referencedTableName="event"/>
      </column>
    </addColumn>
  </changeSet>  
      
  <changeSet id="plantingeventguttersize" author="antti.leppa">
    <renameColumn tableName="plantingevent" oldColumnName="gutternumber" newColumnName="guttersize" columnDataType="integer"/>
  </changeSet>
      
  <changeSet id="plantingeventcellcount" author="antti.leppa">
    <renameColumn tableName="plantingevent" oldColumnName="traycount" newColumnName="cellcount" columnDataType="int(32)"/>
  </changeSet>
  
  <changeSet id="draft" author="antti.leppa">
    <createTable tableName="draft">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="type" type="varchar(191)">
        <constraints nullable="false"/>
      </column>
      <column name="data" type="longtext">
        <constraints nullable="false"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
      
  <changeSet id="removesowinggutter" author="antti.leppa">
    <dropColumn tableName="sowingevent" columnName="gutternumber"/>
  </changeSet>
  
  <changeSet id="productionlnedefaultteam" author="antti.leppa">
    <addColumn tableName="productionline">
      <column name="defaultteam_id" type="binary(16)">
        <constraints nullable="true" foreignKeyName="FK_PRODUCTIONLINE_DEFAULT_TEAM_ID" referencedColumnNames="id" referencedTableName="team"/>
      </column>
    </addColumn>
  </changeSet>
  
  <changeSet id="reviewchanges" author="antti.leppa">
    <delete tableName="packingevent"/>
    <delete tableName="wastageevent"/>
    <delete tableName="plantingevent"/>
    <delete tableName="packingevent"/>
    <delete tableName="harvestevent"/>
    <delete tableName="cultivationobservationeventaction"/>
    <delete tableName="cultivationobservationevent"/>
    <delete tableName="tablespreadevent"/>
    <delete tableName="sowingevent"/>
    <delete tableName="event"/>
    <delete tableName="batch"/>
    <delete tableName="packagesize"/>
    
    <addColumn tableName="event">
      <column name="additionalinformation" type="longtext"/>
    </addColumn>
    
    <modifyDataType tableName="productionline" columnName="linenumber" newDataType="varchar(191)"/>
    <modifyDataType tableName="sowingevent" columnName="amount" newDataType="int(32)"/>
    
    <dropColumn tableName="packagesize" columnName="name"/>

    <addColumn tableName="packagesize">
      <column name="name_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_PACKAGESIZE_NAME_LOCALIZED_ENTRY_ID" referencedColumnNames="id" referencedTableName="localizedentry"/>
      </column>
    </addColumn>
  </changeSet>
  
  <changeSet id="pest" author="antti.leppa">
    <createTable tableName="pest">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="name_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_PEST_NAME_LOCALIZED_ENTRY_ID" referencedColumnNames="id" referencedTableName="localizedentry"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  
  <changeSet id="cultivationobservationeventpest" author="antti.leppa">
    <dropColumn tableName="cultivationobservationevent" columnName="pests"/>
    <createTable tableName="cultivationobservationeventpest">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>      
      <column name="event_id" type="binary(16)">
        <constraints nullable="false" primaryKey="true" foreignKeyName="FK_CULTIVATIONOBSERVATIONEVENTPEST_EVENT_ID" referencedColumnNames="id" referencedTableName="event"/>
      </column>
      <column name="pest_id" type="binary(16)">
        <constraints nullable="false" primaryKey="true" foreignKeyName="FK_CULTIVATIONOBSERVATIONEVENTPEST_PEST_ID" referencedColumnNames="id" referencedTableName="pest"/>
      </column>
    </createTable>
  </changeSet>
  
  <changeSet id="wastageeventphase" author="antti.leppa">
    <addColumn tableName="wastageevent">
      <column name="phase" type="varchar(191)"/>
    </addColumn>
  </changeSet>

  <changeSet id="productionlinetowastageevent" author="ville.koivukangas">
    <addColumn tableName="wastageevent">
      <column name="productionline_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_WASTAGEEVENT_PRODUCTIONLINE_ID" referencedColumnNames="id" referencedTableName="productionline" />
      </column>
    </addColumn>
  </changeSet>  
  
  <changeSet id="amounttoharvestevent" author="ville.koivukangas">
    <addColumn tableName="harvestevent">
      <column name="amount" type="int(32)">
        <constraints nullable="false"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="productionlinetowastageeventnullable" author="antti.leppa">
    <dropNotNullConstraint tableName="wastageevent" columnName="productionline_id" columnDataType="binary(16)"/>
  </changeSet>

  <changeSet id="sowingeventcelltopottype" author="Heikki Kurhinen">
    <renameColumn newColumnName="pottype" oldColumnName="celltype" tableName="sowingevent" columnDataType="varchar(191)"/>
  </changeSet>

  <changeSet id="spreadingeventtablecounttotraycount" author="Heikki Kurhinen">
    <renameColumn newColumnName="traycount" oldColumnName="tablecount" tableName="tablespreadevent" columnDataType="int(32)" />
  </changeSet>

  <changeSet id="deleteharvestteamid" author="Heikki Kurhinen">
    <dropForeignKeyConstraint baseTableName="harvestevent" constraintName="FK_HARVESTEVENT_TEAM_ID"/>
    <dropColumn tableName="harvestevent" columnName="team_id"/>
  </changeSet>

  <changeSet id="harvesteventamounttoguttercount" author="Heikki Kurhinen">
    <renameColumn newColumnName="guttercount" oldColumnName="amount" tableName="harvestevent" columnDataType="int(32)" />
  </changeSet>

  <changeSet id="packagesizesize" author="Heikki Kurhinen">
    <addColumn tableName="packagesize">
      <column name="size" type="int(32)">
        <constraints nullable="false"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="productionlinedefaultgutterholecount" author="Heikki Kurhinen">
    <addColumn tableName="productionline">
      <column name="defaultgutterholecount" type="int(32)"></column>
    </addColumn>
  </changeSet>

  <changeSet id="packingeventpackedamounttopackedcount" author="Heikki Kurhinen">
    <renameColumn newColumnName="packedcount" oldColumnName="packedamount" tableName="packingevent" columnDataType="int(32)" />
  </changeSet>

  <changeSet id="plantingeventguttersizetogutterholecount" author="Heikki Kurhinen">
    <renameColumn newColumnName="gutterholecount" oldColumnName="guttersize" tableName="plantingevent" columnDataType="int(32)" />
  </changeSet>

  <changeSet id="plantingeventcellcounttotraycount" author="Heikki Kurhinen">
    <renameColumn newColumnName="traycount" oldColumnName="cellcount" tableName="plantingevent" columnDataType="int(32)" />
  </changeSet>

  <changeSet id="addharvestteamid" author="Heikki Kurhinen">
    <addColumn tableName="harvestevent">
      <column name="team_id" type="binary(16)">
        <constraints nullable="true" foreignKeyName="FK_HARVESTEVENT_TEAM_ID" referencedColumnNames="id" referencedTableName="team"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="addphasetobatch" author="Heikki Kurhinen">
    <addColumn tableName="batch">
      <column name="phase" type="varchar(191)">
        <constraints nullable="false"/>
      </column>
    </addColumn>
    <sql>UPDATE batch SET phase="SOWING"</sql>
  </changeSet>
  
  <changeSet id="eventlocation" author="Antti Leppa">
    <dropColumn tableName="tablespreadevent" columnName="location"/>
  </changeSet>
  
  <changeSet id="sowingeventseedbatch" author="Antti Leppa">
    <createTable tableName="sowingeventseedbatch">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="sowingevent_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_SOWINGEVENTSEEDBATCH_SOWINGEVENT_ID" referencedColumnNames="id" referencedTableName="sowingevent"/>
      </column>
      <column name="seedbatch_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_SOWINGEVENTSEEDBATCH_SEEDBATCH_ID" referencedColumnNames="id" referencedTableName="seedbatch"/>
      </column>
    </createTable>
    
    <addUniqueConstraint constraintName="UN_SOWINGEVENTSEEDBATCH_SOWINGEVENT_ID_SEEDBATCH_ID" columnNames="sowingevent_id,seedbatch_id" tableName="sowingeventseedbatch"/>
    
    <sql>INSERT INTO sowingeventseedbatch (id, sowingevent_id, seedbatch_id) SELECT UNHEX(REPLACE(uuid(), "-","")), id, seedbatch_id FROM sowingevent</sql>
    
    <dropForeignKeyConstraint baseTableName="sowingevent" constraintName="FK_SOWINGEVENT_SEEDBATCH_ID"/>
    <dropColumn tableName="sowingevent" columnName="seedbatch_id"/>
  </changeSet>
  
  <changeSet id="packing" author="simeon.platonov">
    <createTable tableName="packing">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="product_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_PACKING_PRODUCT_ID" referencedColumnNames="id" referencedTableName="product"/>
      </column>
      <column name="time" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="packagesize_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_PACKING_PACKAGESIZE_ID" referencedColumnNames="id" referencedTableName="packagesize"/>
      </column>
      <column name="packedamount" type="int(32)">
        <constraints nullable="false"/>
      </column>
      <column name="packingstate" type="varchar(20)">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet> 
  
  <changeSet id="packingeventpackedamounttopackedcount" author="simeon.platonov">
    <renameColumn newColumnName="packedcount" oldColumnName="packedamount" tableName="packing" columnDataType="int(32)" />
  </changeSet>
  
  <changeSet id="removeoldpackingeventtavle" author="simeon.platonov">
  	<delete tableName="packingevent"></delete>
  </changeSet>
  
  <changeSet id="addColumnForSeedBatchState" author="Simeon Platonov">
  	<addColumn tableName="seedbatch">
  		<column name="active" type="boolean">
  			<constraints nullable="false"/>
  		</column>
  	</addColumn>
  	<sql>
  	  UPDATE seedbatch SET active = true
  	</sql>
  </changeSet>

  <changeSet id="removeteams" author="Simeon Platonov">
    <dropForeignKeyConstraint baseTableName="productionline" constraintName="FK_PRODUCTIONLINE_DEFAULT_TEAM_ID"/>
    <dropForeignKeyConstraint baseTableName="harvestevent" constraintName="FK_HARVESTEVENT_TEAM_ID"/>
    <dropColumn tableName="productionline" columnName="defaultteam_id"/>
    <dropColumn tableName="harvestevent" columnName="team_id"/>
    <delete tableName="team"/>
  </changeSet>

  <changeSet id="campaigns" author="Simeon Platonov">
    <createTable tableName="campaign">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="name" type="varchar(100)">
        <constraints nullable="false"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <createTable tableName="campaignproduct">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="campaign_id" type="binary(16)">
        <constraints nullable="false" referencedTableName="campaign" referencedColumnNames="id" foreignKeyName="FK_CAMPAIGN_PRODUCT_CAMPAIGN_ID"/>
      </column>
      <column name="product_id" type="binary(16)">
        <constraints nullable="false" referencedTableName="product" referencedColumnNames="id" foreignKeyName="FK_CAMPAIGN_PRODUCT_PRODUCT_ID"/>
      </column>
      <column name="count" type="INTEGER">
        <constraints nullable="false"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <changeSet id="campaignpackings" author="Simeon Platonov">
    <dropNotNullConstraint tableName="packing" columnName="product_id" columnDataType="binary(16)"/>
    <dropNotNullConstraint tableName="packing" columnName="packagesize_id" columnDataType="binary(16)"/>
    <dropNotNullConstraint tableName="packing" columnName="packedcount" columnDataType="int(32)"/>
    <addColumn tableName="packing">
      <column name="type" type="varchar(30)">
        <constraints nullable="false"/>
      </column>
      <column name="campaign_id" type="binary(16)">
        <constraints referencedTableName="campaign" referencedColumnNames="id" foreignKeyName="FK_PACKING_CAMPAIGN_ID"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="remainingunitserrors" author="Simeon Platonov">
    <addColumn tableName="batch">
      <column name="totalsowed" type="INTEGER">
        <constraints nullable="false"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="timestamptodatetime" author="Simeon Platonov">
    <modifyDataType tableName="batch" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="batch" columnName="modifiedat" newDataType="datetime(6)"/>

    <modifyDataType tableName="campaign" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="campaign" columnName="modifiedat" newDataType="datetime(6)"/>

    <modifyDataType tableName="campaignproduct" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="campaignproduct" columnName="modifiedat" newDataType="datetime(6)"/>

    <modifyDataType tableName="draft" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="draft" columnName="modifiedat" newDataType="datetime(6)"/>

    <modifyDataType tableName="event" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="event" columnName="modifiedat" newDataType="datetime(6)"/>
    <modifyDataType tableName="event" columnName="starttime" newDataType="datetime(6)"/>
    <modifyDataType tableName="event" columnName="endtime" newDataType="datetime(6)"/>

    <modifyDataType tableName="packagesize" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="packagesize" columnName="modifiedat" newDataType="datetime(6)"/>

    <modifyDataType tableName="packing" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="packing" columnName="modifiedat" newDataType="datetime(6)"/>
    <modifyDataType tableName="packing" columnName="time" newDataType="datetime(6)"/>

    <modifyDataType tableName="performedcultivationaction" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="performedcultivationaction" columnName="modifiedat" newDataType="datetime(6)"/>

    <modifyDataType tableName="pest" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="pest" columnName="modifiedat" newDataType="datetime(6)"/>

    <modifyDataType tableName="product" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="product" columnName="modifiedat" newDataType="datetime(6)"/>

    <modifyDataType tableName="productionline" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="productionline" columnName="modifiedat" newDataType="datetime(6)"/>

    <modifyDataType tableName="seed" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="seed" columnName="modifiedat" newDataType="datetime(6)"/>

    <modifyDataType tableName="seedbatch" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="seedbatch" columnName="modifiedat" newDataType="datetime(6)"/>
    <modifyDataType tableName="seedbatch" columnName="time" newDataType="datetime(6)"/>

    <modifyDataType tableName="team" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="team" columnName="modifiedat" newDataType="datetime(6)"/>

    <modifyDataType tableName="wastagereason" columnName="createdat" newDataType="datetime(6)"/>
    <modifyDataType tableName="wastagereason" columnName="modifiedat" newDataType="datetime(6)"/>
  </changeSet>

  <changeSet id="Subcontractor products" author="Simeon Platonov">
    <addColumn tableName="product">
      <column name="issubcontractorproduct" type="boolean">
        <constraints nullable="false"/>
      </column>
    </addColumn>
  </changeSet>

  <changeSet id="Cut packing" author="Simeon Platonov">
    <createTable tableName="cutpacking">
      <column name="id" type="binary(16)">
        <constraints unique="true" nullable="false" primaryKey="true"/>
      </column>
      <column name="creatorid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="lastmodifierid" type="binary(16)">
        <constraints nullable="false"/>
      </column>
      <column name="createdat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="modifiedat" type="timestamp">
        <constraints nullable="false"/>
      </column>
      <column name="product_id" type="binary(16)">
        <constraints nullable="false" referencedTableName="product" referencedColumnNames="id" foreignKeyName="FK_CUT_PACKING_PRODUCT_ID"/>
      </column>
      <column name="productionline_id" type="binary(16)">
        <constraints nullable="false" foreignKeyName="FK_CUT_PACKING_PRODUCTIONLINE_ID" referencedColumnNames="id" referencedTableName="productionline"/>
      </column>
      <column name="weight" type="double">
        <constraints nullable="false"/>
      </column>
      <column name="cuttingday" type="datetime(6)">
        <constraints nullable="false"/>
      </column>
      <column name="sowingday" type="datetime(6)">
        <constraints nullable="false"/>
      </column>
      <column name="producer" type="longtext">
        <constraints nullable="false"/>
      </column>
      <column name="contactinformation" type="longtext">
        <constraints nullable="false"/>
      </column>
      <column name="guttercount" type="integer">
        <constraints nullable="false"/>
      </column>
      <column name="gutterholecount" type="integer">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
</databaseChangeLog>
